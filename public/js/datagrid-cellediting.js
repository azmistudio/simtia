!function(e){function t(t,i){var d=e(this),l=d.datagrid("cell");if(!d.datagrid("input",l))return d.datagrid("gotoCell",i),!1}function i(t){var i=e(this),d=i.datagrid("cell");if(d)return i.datagrid("input",d)?void 0:(i.datagrid("editCell",{index:d.index,field:d.field,value:""}),!1)}function d(t,i){var d=e(t).datagrid("options");d.finder.getTr(t,i.index).find('td[field="'+i.field+'"]').removeClass("datagrid-row-selected"),d.onUnselectCell.call(t,i.index,i.field)}function l(t){e(t).datagrid("getPanel").find("td.datagrid-row-selected").removeClass("datagrid-row-selected")}function n(t,i){var d=e(t).datagrid("options");d.singleSelect&&l(t),d.finder.getTr(t,i.index).find('td[field="'+i.field+'"]').addClass("datagrid-row-selected"),d.onSelectCell.call(t,i.index,i.field)}function a(t,i){var d=e(t),l=d.datagrid("cell");if(l){var n=d.datagrid("input",l);if(n)if(i){if(!d.datagrid("validateRow",l.index))return d.datagrid("gotoCell",l),n.focus(),!1;d.datagrid("endEdit",l.index),d.datagrid("gotoCell",l)}else d.datagrid("cancelEdit",l.index),d.datagrid("gotoCell",l)}return!0}e.extend(e.fn.datagrid.defaults,{clickToEdit:!0,dblclickToEdit:!1,navHandler:{37:function(i){var d=e(this).datagrid("options");return t.call(this,i,d.isRtl?"right":"left")},39:function(i){var d=e(this).datagrid("options");return t.call(this,i,d.isRtl?"left":"right")},38:function(e){return t.call(this,e,"up")},40:function(e){return t.call(this,e,"down")},13:function(t){return function(t){var i=e(this),d=i.datagrid("cell");if(d){var l=i.datagrid("input",d);if(l){if("textarea"==l[0].tagName.toLowerCase())return;a(this,!0)}else i.datagrid("editCell",d);return!1}}.call(this,t)},27:function(e){return function(e){return a(this,!1),!1}.call(this,e)},8:function(e){return i.call(this,e)},46:function(e){return i.call(this,e)},keypress:function(t){if(!t.metaKey&&!t.ctrlKey){var i=e(this),d=i.datagrid("cell");if(d&&!i.datagrid("input",d)){var l=e("<span></span>");l.html(String.fromCharCode(t.which));var n=l.text();if(l.remove(),n)return i.datagrid("editCell",{index:d.index,field:d.field,value:n}),!1}}}},onBeforeCellEdit:function(e,t){},onCellEdit:function(t,i,d){var l=e(this).datagrid("input",{index:t,field:i});l&&null!=d&&l.val(d)},onSelectCell:function(e,t){},onUnselectCell:function(e,t){}}),e.extend(e.fn.datagrid.methods,{editCell:function(t,i){return t.each(function(){!function(t,i){var d=e(t),l=d.datagrid("options");if(n=d.datagrid("input",i))return d.datagrid("gotoCell",i),void n.focus();if(a(t,!0)&&0!=l.onBeforeCellEdit.call(t,i.index,i.field)){var n,r=d.datagrid("getColumnFields",!0).concat(d.datagrid("getColumnFields"));e.map(r,function(e){var t=d.datagrid("getColumnOption",e);t.editor1=t.editor,e!=i.field&&(t.editor=null)}),d.datagrid("getColumnOption",i.field).editor?(d.datagrid("beginEdit",i.index),(n=d.datagrid("input",i))?(d.datagrid("gotoCell",i),setTimeout(function(){n.unbind(".cellediting").bind("keydown.cellediting",function(e){if(13==e.keyCode)return l.navHandler[13].call(t,e)}),n.focus()},0),l.onCellEdit.call(t,i.index,i.field,i.value)):(d.datagrid("cancelEdit",i.index),d.datagrid("gotoCell",i))):d.datagrid("gotoCell",i),e.map(r,function(e){var t=d.datagrid("getColumnOption",e);t.editor=t.editor1})}}(this,i)})},isEditing:function(t,i){var d=e.data(t[0],"datagrid").options.finder.getTr(t[0],i);return d.length&&d.hasClass("datagrid-row-editing")},gotoCell:function(t,i){return t.each(function(){!function(t,i){var d=e(t),a=d.datagrid("options"),r=d.datagrid("getPanel").focus(),o=d.datagrid("cell");if(o){var c=d.datagrid("input",o);if(c)return void c.focus()}if("object"!=typeof i){var g=r.find("td.datagrid-row-selected");if(g){var s=d.datagrid("getColumnFields",!0).concat(d.datagrid("getColumnFields")),f=g.attr("field"),u=g.closest("tr.datagrid-row"),C=parseInt(u.attr("datagrid-row-index")),v=e.inArray(f,s);if("up"==i&&C>0)C--;else if("down"==i)a.finder.getRow(t,C+1)&&C++;else if("left"==i)for(var h=v-1;h>=0;){if(!d.datagrid("getColumnOption",s[h]).hidden){v=h;break}h--}else if("right"==i)for(h=v+1;h<=s.length-1;){if(!d.datagrid("getColumnOption",s[h]).hidden){v=h;break}h++}p({index:C,field:f=s[v]})}}else p(i);function p(e){d.datagrid("scrollTo",e.index),l(t),n(t,e);var i=a.finder.getTr(t,e.index,"body",2).find('td[field="'+e.field+'"]');if(i.length){var r=d.data("datagrid").dc.body2,o=i.position().left;o<0?r._scrollLeft(r._scrollLeft()+o*(a.isRtl?-1:1)):o+i._outerWidth()>r.width()&&r._scrollLeft(r._scrollLeft()+(o+i._outerWidth()-r.width())*(a.isRtl?-1:1))}}}(this,i)})},enableCellEditing:function(t){return t.each(function(){var t,i,d,l;i=e(t=this),d=i.datagrid("options"),(l=i.datagrid("getPanel")).attr("tabindex",1).css("outline-style","none").unbind(".cellediting").bind("keydown.cellediting",function(e){var i=d.navHandler[e.keyCode];if(i)return i.call(t,e)}).bind("keypress.cellediting",function(e){return d.navHandler.keypress.call(t,e)}),l.panel("panel").unbind(".cellediting").bind("keydown.cellediting",function(e){e.stopPropagation()}).bind("keypress.cellediting",function(e){e.stopPropagation()}).bind("mouseover.cellediting",function(t){var i=e(t.target).closest("td[field]");i.length&&(i.addClass("datagrid-row-over"),i.closest("tr.datagrid-row").removeClass("datagrid-row-over"))}).bind("mouseout.cellediting",function(t){e(t.target).closest("td[field]").removeClass("datagrid-row-over")}),d.isRtl="rtl"==i.datagrid("getPanel").css("direction").toLowerCase(),d.oldOnClickCell=d.onClickCell,d.oldOnDblClickCell=d.onDblClickCell,d.onClickCell=function(t,i,l){d.clickToEdit?e(this).datagrid("editCell",{index:t,field:i}):a(this,!0)&&e(this).datagrid("gotoCell",{index:t,field:i}),d.oldOnClickCell.call(this,t,i,l)},d.dblclickToEdit&&(d.onDblClickCell=function(t,i,l){e(this).datagrid("editCell",{index:t,field:i}),d.oldOnDblClickCell.call(this,t,i,l)}),d.OldOnBeforeSelect=d.onBeforeSelect,d.onBeforeSelect=function(){return!1},i.datagrid("clearSelections")})},disableCellEditing:function(t){return t.each(function(){var t,i,d;i=(t=e(this)).datagrid("getPanel"),(d=t.datagrid("options")).onClickCell=d.oldOnClickCell||d.onClickCell,d.onDblClickCell=d.oldOnDblClickCell||d.onDblClickCell,d.onBeforeSelect=d.OldOnBeforeSelect||d.onBeforeSelect,i.unbind(".cellediting").find("td.datagrid-row-selected").removeClass("datagrid-row-selected"),i.panel("panel").unbind(".cellediting")})},enableCellSelecting:function(t){return t.each(function(){var t,i,a,r,o,c;a=(i=e(t=this)).data("datagrid"),r=i.datagrid("getPanel"),o=a.options,c=a.dc,r.attr("tabindex",1).css("outline-style","none").unbind(".cellediting").bind("keydown.cellediting",function(e){var i=o.navHandler[e.keyCode];if(i)return i.call(t,e)}),c.body1.add(c.body2).unbind(".cellediting").bind("click.cellediting",function(i){var a=e(i.target).closest(".datagrid-row");if(a.length&&a.parent().length){var r=e(i.target).closest("td[field]",a);if(r.length){var c={index:parseInt(a.attr("datagrid-row-index")),field:r.attr("field")};o.singleSelect?n(t,c):o.ctrlSelect?i.ctrlKey?r.hasClass("datagrid-row-selected")?d(t,c):n(t,c):(l(t),n(t,c)):r.hasClass("datagrid-row-selected")?d(t,c):n(t,c)}}}).bind("mouseover.cellediting",function(t){var i=e(t.target).closest("td[field]");i.length&&(i.addClass("datagrid-row-over"),i.closest("tr.datagrid-row").removeClass("datagrid-row-over"))}).bind("mouseout.cellediting",function(t){e(t.target).closest("td[field]").removeClass("datagrid-row-over")}),o.isRtl="rtl"==i.datagrid("getPanel").css("direction").toLowerCase(),o.OldOnBeforeSelect=o.onBeforeSelect,o.onBeforeSelect=function(){return!1},i.datagrid("clearSelections")})},disableCellSelecting:function(t){return t.each(function(){!function(t){var i=e(t),d=i.data("datagrid"),l=i.datagrid("getPanel"),n=d.options;n.onBeforeSelect=n.OldOnBeforeSelect||n.onBeforeSelect,l.unbind(".cellediting").find("td.datagrid-row-selected").removeClass("datagrid-row-selected");var a=d.dc;a.body1.add(a.body2).unbind(".cellediting")}(this)})},input:function(t,i){if(!i)return null;var d=t.datagrid("getEditor",i);if(d){var l=e(d.target);return l.hasClass("textbox-f")&&(l=l.textbox("textbox")),l}return null},cell:function(t){return i=t[0],(d=e(i).datagrid("getPanel").find("td.datagrid-row-selected")).length?{index:parseInt(d.closest("tr.datagrid-row").attr("datagrid-row-index")),field:d.attr("field")}:null;var i,d},getSelectedCells:function(t){return i=t[0],d=[],e(i).datagrid("getPanel").find("td.datagrid-row-selected").each(function(){var t=e(this);d.push({index:parseInt(t.closest("tr.datagrid-row").attr("datagrid-row-index")),field:t.attr("field")})}),d;var i,d}})}(jQuery);